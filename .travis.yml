language: cpp

#os:
#  - windows
#  - linux

matrix:
  include:
  - os: windows
    env: CMAKE_PREFIX_PATH='C:/Qt/5.8.0/msvc2015_64'
  - os: linux

dist: xenial

cache:
  directories:
    - /c/Qt

addons:
  apt:
    sources:
    - sourceline: 'ppa:chronitis/debtools'
    - sourceline: 'deb http://ppa.launchpad.net/chronitis/debtools/ubuntu artful main'
    packages:
    - cmake make g++
    - libssl-dev libsodium-dev libcurl4-openssl-dev libavahi-compat-libdnssd-dev libsystemd-dev
    - xorg-dev libx11-dev libgl1-mesa-glx libegl1-mesa qtbase5-dev qtdeclarative5-dev libqt5svg5-dev
    - dpkg-dev git-buildpackage

install:
  - if [[ $TRAVIS_OS_NAME = windows ]]; then
      qt_installer_filename='qt-unified-windows-x86-3.0.6-online.exe';
      wget "https://download.qt.io/archive/online_installers/3.0/${qt_installer_filename}";
      chmod +x "$qt_installer_filename";
      qt-unified-windows-x86-3.0.6-online.exe;
      qt_install_cmd="${qt_installer_filename} -v --script './extract-qt.qs' | grep '\(QTCI\|operation\)'";
      sh -c '$qt_installer_filename'; \
      #OUTPUT='C:/Qt' && PACKAGES='qt.58.win64_msvc2015_64' && $qt_install_cmd ;    # printf '#choco install wixtoolset;';
    fi
#     if [[ -z "$VERBOSE" ]]; then
#        qt_install_cmd="'./${qt_installer_filename}' --script './extract-qt.qs'";
#      else;
#        qt_install_cmd="'./${qt_installer_filename}' -v --script './extract-qt.qs' | grep '\(QTCI\|operation\)'";
#      fi;

#env:
#  - CMAKE_PREFIX_PATH='C:/Qt/5.8.0/msvc2015_64'

script:
  - touch debian/changelog
  - if [[ $TRAVIS_OS_NAME = linux ]]; then gbp dch --ignore-branch ; fi
  - echo "CMAKE_PREFIX_PATH=$CMAKE_PREFIX_PATH"
  - pwd
  - ls -l
  - ls -l debian
  - mkdir build
  - cd build
  - cmake -D SYNERGY_ENTERPRISE=ON .. || ( cat 'CMakeFiles/CMakeOutput.log' ; exit 1 )
  - cmake --build .
